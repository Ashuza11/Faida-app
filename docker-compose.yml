# docker-compose.yml - Local Development with Neon Database
# Usage: docker-compose up --build

services:
  app:
    build:
      context: ./src
      dockerfile: Dockerfile
    container_name: faida_app
    env_file:
      - .env.development  # Use development environment
    ports:
      - "5000:5000"
    volumes:
      - ./src:/code
    environment:
      - FLASK_ENV=development
      - FLASK_DEBUG=1
    command: >
      sh -c "flask db upgrade && 
            gunicorn --bind 0.0.0.0:5000 --reload --workers 1 --timeout 120 run:app"

# ===========================================
# ALTERNATIVE: Local PostgreSQL (uncomment if needed)
# ===========================================
# services:
#   db:
#     image: postgres:15-alpine
#     container_name: faida_db
#     restart: always
#     environment:
#       POSTGRES_PASSWORD: ${DBPASS:-localpassword}
#       POSTGRES_USER: ${DBUSER:-faida_user}
#       POSTGRES_DB: ${DBNAME:-faida_dev}
#     volumes:
#       - postgres-data:/var/lib/postgresql/data
#     ports:
#       - "5432:5432"
#     healthcheck:
#       test: ["CMD-SHELL", "pg_isready -U ${DBUSER:-faida_user} -d ${DBNAME:-faida_dev}"]
#       interval: 5s
#       timeout: 5s
#       retries: 5
#
#   app:
#     build:
#       context: ./src
#       dockerfile: Dockerfile
#     container_name: faida_app
#     env_file:
#       - .env.local
#     ports:
#       - "5000:5000"
#     volumes:
#       - ./src:/code
#     depends_on:
#       db:
#         condition: service_healthy
#     command: gunicorn --bind 0.0.0.0:5000 --reload --workers 1 run:app
#
# volumes:
#   postgres-data: